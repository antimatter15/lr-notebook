{% extends "layout.html" %}
{% from "macros/projects.html" import render_project_entry %}

{% block title %}{{ this.name }}{% endblock %}

{% block header %}
{% set project_to_count = {} %}
{% for project in site.query('/projects') %} 
  {% set fname = project.path.split('/')[-1] %}
  {% set count = project.children|list|length %}
  {% set _ = project_to_count.update({fname:count}) %}
{% endfor %}
{% set counts = project_to_count|dictsort(false, 'value') %}
{% set max_count = counts[-1][1] %}
<small>
{% for project in site.query('/projects') %}
  {% set count = project_to_count[project.name]|default(0) %}
  {% set lightness = 82 - 35*(count/(max_count+1)) %}
  <a {% if project.name==this.name %}class="active"{%else%}style="color:hsl(0, 0%, {{lightness}}%);"{%endif%} href="{{project|url}}">{{project.name}} ({{count}})</a>
{% endfor %}
</small>
{% endblock %}

{% block body %}
<h1>{{ this.name }}</h1>
<div class="description">{{ this.description }}</div>

<br>

{% for entry in this.children %}
{{render_project_entry(entry)}}
{% endfor %}

{% endblock %}

{% for entry in this.children %}
<h3>{{entry.date.strftime('%b %e,%Y')}}: <a href="{{entry|url}}">{% if entry.description%}{{entry.description}}{%else%}Untitled{%endif%}</a></h3>
{% if entry.body %}{{entry.body}}{%else%}{{render_attachments(entry)}}{%endif%}
{% endfor %}
